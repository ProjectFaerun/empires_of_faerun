namespace = ZA

#Written by:
#Matthew Clohessy
#Milla Isaksson

### Events for aquiring zakhara Artifacts ###
#An envoy from zakhara appears, hidden event generates the envoy then pings
character_event = {
	id = ZA.60000
	hide_window = yes
	is_triggered_only = yes

    only_capable = yes
    only_playable = yes
    has_dlc = "Jade Dragon"
    prisoner = no
    war = no
    min_age = 16

    trigger = {
        NOT = { zakhara = { governor = { character = ROOT } } }
        is_inaccessible_trigger = no
        zakhara_diplo_interaction_trigger = yes
        zakhara = {
            NOR = {
                has_status = zakhara_civil_war
                has_status = zakhara_plague
            }
        }
    }
	
	weight_multiplier = {
		days = 1
		modifier = {
			factor = 0.1
			any_artifact = { has_artifact_flag = zakhara }
		}
        modifier = {
            zakhara = { has_status = zakhara_unrest }
            factor = 0.6
        }
        modifier = {
            zakhara = { has_status = zakhara_pantheist_invasion }
            factor = 0.3
        }
        modifier = {
            zakhara = { has_status = zakhara_badia_invasion }
            factor = 0.3
        }
        modifier = {
            zakhara = { has_status = zakhara_famine }
            factor = 0.3
        }
        modifier = {
            zakhara = { has_status = zakhara_golden_age }
            factor = 3
        }
        modifier = {
            zakhara = { has_policy = zakhara_expansionist }
            factor = 2
        }
	}
	
	immediate = {
		zakhara = {
			governor = {
				random_list = {
					50 = {
						modifier = {
							NOT = {
								has_game_rule = {
									name = gender
									value = all
								}
							}
							factor = 0.05
						}
						create_character = {
							age = 32
							culture = PREV
							religion = PREV
							dynasty = actually_culture
							female = yes
							random_traits = yes
               				historical = yes
						}
					}
					50 = {
						create_character = {
							age = 32
							culture = PREV
							religion = PREV
							dynasty = actually_culture
							female = no
							random_traits = yes
							historical = yes
						}
					}
				}
				new_character = {
					set_character_flag = zakhara_envoy_artifacts
					random = {
						chance = 10
						remove_education_effect = yes
						add_trait = brilliant_strategist
						change_martial = 5
						set_character_flag = zakhara_envoy_warrior
					}
					character_event = { id = ZA.60001 }
				}
			}
		}
	}
}
#Ping for picture
character_event = {
	id = ZA.60001
	has_dlc = "Jade Dragon"
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		FROM = { character_event = { id = ZA.60002 } }
	}
}
#An envoy from zakhara has arrived at your court offering to trade
character_event = {
	id = ZA.60002
	has_dlc = "Jade Dragon"
	desc = {
		text = EVT_DESC_ZA_60002_A
		trigger = { FROM = { has_character_flag = zakhara_envoy_artifacts } }
	}
	desc = { #Envoy from HL.5000
		text = EVT_DESC_ZA_60002_B
		trigger = { FROM = { has_character_flag = is_zakhara_envoy } }
	}
    picture = GFX_evt_chinese_bureaucrat
    border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		###Find possible people to trade
		#Eunuch, same requirements as grace decision
		if = {
			limit = {
				any_courtier = {
					NOR = {
						has_character_flag = originated_from_zakhara_court
						has_character_flag = eunuch_gift
						is_landed = yes
						is_female = yes
						is_betrothed = yes
						spouse = { always = yes }
						trait = incapable
						trait = inbred
						trait = imbecile
					}
					OR = {
						is_close_relative = ROOT
						diplomacy = 20
						martial = 20
						stewardship = 20
						intrigue = 20
						learning = 20
						trait = strong
						trait = genius
						trait = quick
						has_fair_trait_trigger = yes
						trait = robust
						trait = shrewd
						trait = architect
						trait = strategist
						trait = scholar
					}
					OR = {
						is_adult = yes
						AND = {
							is_close_relative = ROOT
							age = 12
						}
					}
					is_heir = no
					is_ill = no
					is_inaccessible_trigger = no
				}
			}
			random_courtier = {
				limit = {
					NOR = {
						has_character_flag = originated_from_zakhara_court
						has_character_flag = eunuch_gift
						is_landed = yes
						is_female = yes
						is_betrothed = yes
						spouse = { always = yes }
						trait = incapable
						trait = inbred
						trait = imbecile
					}
					OR = {
						is_close_relative = ROOT
						diplomacy = 20
						martial = 20
						stewardship = 20
						intrigue = 20
						learning = 20
						trait = strong
						trait = genius
						trait = quick
						has_fair_trait_trigger = yes
						trait = robust
						trait = shrewd
						trait = architect
						trait = strategist
						trait = scholar
					}
					OR = {
						is_adult = yes
						AND = {
							is_close_relative = ROOT
							age = 12
						}
					}
					is_heir = no
					is_ill = no
					is_inaccessible_trigger = no
				}
				save_event_target_as = zakhara_envoy_eunuch_target
			}
		}
		#Concubine, same potential as grace decision
		if = {
			limit = {
				any_courtier = {
					OR = {
						AND = {
							zakhara = {
								offmap_ruler = {
									is_female = yes
								}
							}
							is_female = no
						}
						AND = {
							zakhara = {
								offmap_ruler = {
									is_female = no
								}
							}
							is_female = yes
						}
					}
					is_close_relative = ROOT
					is_adult = yes
					NOT = { age = 45 }
					NOR = {
						has_character_flag = originated_from_zakhara_court
						is_landed = yes
						is_betrothed = yes
						is_married = yes
						trait = incapable
						trait = inbred
						trait = imbecile
						trait = celibate
					}
					is_heir = no
					is_ill = no
					NOT = { trait = wounded }
					is_inaccessible_trigger = no
				}
			}
			random_courtier = {
				limit = {
					OR = {
						AND = {
							zakhara = {
								offmap_ruler = {
									is_female = yes
								}
							}
							is_female = no
						}
						AND = {
							zakhara = {
								offmap_ruler = {
									is_female = no
								}
							}
							is_female = yes
						}
					}
					is_close_relative = ROOT
					is_adult = yes
					NOT = { age = 45 }
					NOR = {
						has_character_flag = originated_from_zakhara_court
						is_landed = yes
						is_betrothed = yes
						is_married = yes
						trait = incapable
						trait = inbred
						trait = imbecile
						trait = celibate
					}
					is_heir = no
					is_ill = no
					NOT = { trait = wounded }
					is_inaccessible_trigger = no
				}
				save_event_target_as = zakhara_envoy_concubine_target
			}
		}
	}
	
	option = { #Send a eunuch
		name = EVT_OPTA_ZA_60002
		trigger = { event_target:zakhara_envoy_eunuch_target = { always = yes } }
		tooltip_info = yes
		custom_tooltip = { text = ZA_60002_eunuch_tt }
		event_target:zakhara_envoy_eunuch_target = {
			show_scope_change = no
			hidden_effect = {
				if = {
					limit = {
						NOT = {
							trait = eunuch
						}
					}
					add_trait = eunuch
				}
			}
			leave_court_for_zakhara_effect = yes
		}
		if = {
			limit = {
				OR = {
					ROOT = {
						liked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
					event_target:zakhara_envoy_eunuch_target = {
						liked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
				}
				NOR = {
					ROOT = {
						disliked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
					event_target:zakhara_envoy_eunuch_target = {
						disliked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
				}
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_likes_tt }
				}
			}
			set_character_flag = zakhara_envoy_trade_like
		}
		if = {
			limit = {
				OR = {
					ROOT = {
						disliked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
					event_target:zakhara_envoy_eunuch_target = {
						disliked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
				}
				NOR = {
					ROOT = {
						liked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
					event_target:zakhara_envoy_eunuch_target = {
						liked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
				}
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_dislikes_tt }
				}
			}
			set_character_flag = zakhara_envoy_trade_dislike
		}
		if = {
			limit = {
				OR = {
					ROOT = {
						liked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
					event_target:zakhara_envoy_eunuch_target = {
						liked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
				}
				OR = {
					ROOT = {
						disliked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
					event_target:zakhara_envoy_eunuch_target = {
						disliked_by_offmap = {
							type = zakhara
							context = eunuch
						}
					}
				}
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_likes_but_dislikes_tt }
				}
			}
		}
		character_event = { id = ZA.60003 days = 1 }
	}
	option = { #Send a concubine
		name = EVT_OPTB_ZA_60002
		trigger = { event_target:zakhara_envoy_concubine_target = { always = yes } }
		tooltip_info = yes
		custom_tooltip = { text = ZA_60002_concubine_tt }
		event_target:zakhara_envoy_concubine_target = {
			show_scope_change = no
			leave_court_for_zakhara_effect = yes
		}
		if = {
			limit = {
				OR = {
					ROOT = {
						liked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
					event_target:zakhara_envoy_concubine_target = {
						liked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
				}
				NOR = {
					ROOT = {
						disliked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
					event_target:zakhara_envoy_concubine_target = {
						disliked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
				}
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_likes_tt }
				}
			}
			set_character_flag = zakhara_envoy_trade_like
		}
		if = {
			limit = {
				OR = {
					ROOT = {
						disliked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
					event_target:zakhara_envoy_concubine_target = {
						disliked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
				}
				NOR = {
					ROOT = {
						liked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
					event_target:zakhara_envoy_concubine_target = {
						liked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
				}
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_dislikes_tt }
				}
			}
			set_character_flag = zakhara_envoy_trade_dislike
		}
		if = {
			limit = {
				OR = {
					ROOT = {
						liked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
					event_target:zakhara_envoy_concubine_target = {
						liked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
				}
				OR = {
					ROOT = {
						disliked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
					event_target:zakhara_envoy_concubine_target = {
						disliked_by_offmap = {
							type = zakhara
							context = concubine
						}
					}
				}
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_likes_but_dislikes_tt }
				}
			}
		}
		character_event = { id = ZA.60003 days = 1 }
	}
	option = { #Send gold
		name = EVT_OPTC_ZA_60002
		trigger = { 
			NOR = {
				event_target:zakhara_envoy_eunuch_target = { always = yes }
				event_target:zakhara_envoy_concubine_target = { always = yes }
			}
		}
		scaled_wealth = { value = -2 min = -200 }
		if = {
			limit = {
				ROOT = {
					liked_by_offmap = {
						type = zakhara
						context = wealth
					}
				}
				NOT = {
					ROOT = {
						disliked_by_offmap = {
							type = zakhara
							context = wealth
						}
					}
				}
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_likes_tt }
				}
			}
			set_character_flag = zakhara_envoy_trade_like
		}
		if = {
			limit = {
				ROOT = {
					disliked_by_offmap = {
						type = zakhara
						context = wealth
					}
				}
				NOT = {
					ROOT = {
						liked_by_offmap = {
							type = zakhara
							context = wealth
						}
					}
				}
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_dislikes_tt }
				}
			}
			set_character_flag = zakhara_envoy_trade_dislike
		}
		if = {
			limit = {
				ROOT = {
					liked_by_offmap = {
						type = zakhara
						context = wealth
					}
				}
				ROOT = {
					disliked_by_offmap = {
						type = zakhara
						context = wealth
					}
				}
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_likes_but_dislikes_tt }
				}
			}
		}
		character_event = { id = ZA.60003 days = 1 }
	}
	option = {
		name = EVT_OPTD_ZA_60002
		prestige = -150
		if = {
			limit = {
				ROOT = { liked_by_offmap = { type = zakhara } }
				NOT = { ROOT = { disliked_by_offmap = { type = zakhara } } }
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_likes_tt }
				}
			}
			set_character_flag = zakhara_envoy_trade_like
		}
		if = {
			limit = {
				ROOT = { disliked_by_offmap = { type = zakhara } }
				NOT = { ROOT = { liked_by_offmap = { type = zakhara } } }
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_dislikes_tt }
				}
			}
			set_character_flag = zakhara_envoy_trade_dislike
		}
		if = {
			limit = {
				ROOT = { liked_by_offmap = { type = zakhara } }
				ROOT = { disliked_by_offmap = { type = zakhara } }
			}
			e_zakhara_west_governor = {
				offmap_power = {
					show_scope_change = no
					custom_tooltip = { text = ZA_60002_likes_but_dislikes_tt }
				}
			}
		}
		hidden_effect = {
			random_list = {
				8 = { set_character_flag = zakhara_envoy_feast_good }
				2 = { set_character_flag = zakhara_envoy_feast_bad }
			}
		}
		character_event = { id = ZA.60003 days = 1 }
	}
	option = {
		name = EVT_OPTE_ZA_60002
		detract_grace_trivial_effect = yes
		hidden_effect = { 
			if = { 
				limit = { 
					FROM = { has_character_flag = zakhara_envoy_artifacts }
				}
				FROM = { death = { death_reason = death_went_back_to_zakhara } }
			}
		}
	}
}
#Get an random artifact in exchange for your trade
character_event = {
	id = ZA.60003
	has_dlc = "Jade Dragon"
	desc = {
		text = EVT_DESC_ZA_60003_A
		trigger = { 
			NOR = {
				has_character_flag = zakhara_envoy_feast_good
				has_character_flag = zakhara_envoy_feast_bad
			}
		}
	}
	desc = {
		text = EVT_DESC_ZA_60003_B
		trigger = { has_character_flag = zakhara_envoy_feast_good }
	}
	desc = {
		text = EVT_DESC_ZA_60003_C
		trigger = { has_character_flag = zakhara_envoy_feast_bad }
	}
    picture = GFX_evt_china_diplomatic_success
    border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { has_character_flag = zakhara_envoy_feast_bad }
			break = yes
		}
		#Spawn artifacts in a character with the current Emperor's culture and religion so loc reffering that stays static and then transfer to intended owner.
		random_list = {
			5 = { 
				modifier = {
					factor = 0
					has_artifact = zakhara_jade_dragon
				}
				modifier = {
					factor = 3
					has_character_flag = zakhara_envoy_trade_like
				}
				modifier = {
					factor = 0.3
					has_character_flag = zakhara_envoy_trade_dislike
				}
				add_artifact = zakhara_jade_dragon
				new_artifact = {
					save_event_target_as = zakhara_envoy_artifact
				}
			}
			15 = { 
				modifier = {
					factor = 0
					has_artifact = zakhara_dragon_amulet
				}
				modifier = {
					factor = 3
					has_character_flag = zakhara_envoy_trade_like
				}
				modifier = {
					factor = 0.3
					has_character_flag = zakhara_envoy_trade_dislike
				}
				add_artifact = zakhara_dragon_amulet
				new_artifact = {
					save_event_target_as = zakhara_envoy_artifact
				}
			}
			40 = {
				modifier = {
					factor = 0
					has_artifact = zakhara_artwork
				}
				modifier = {
					factor = 0.3
					has_character_flag = zakhara_envoy_trade_like
				}
				add_artifact = zakhara_artwork
				new_artifact = {
					set_name="zakhara_artwork_name"
					save_event_target_as = zakhara_envoy_artifact
				}
			}
			40 = { 
				modifier = {
					factor = 0
					has_artifact = zakhara_calligraphy
				}
				modifier = {
					factor = 0.3
					has_character_flag = zakhara_envoy_trade_like
				}
				add_artifact = zakhara_calligraphy
				new_artifact = {
					set_name="zakhara_calligraphy_name"
					save_event_target_as = zakhara_envoy_artifact
				}
			}
			40 = { 
				modifier = {
					factor = 0
					has_artifact = zakhara_sculpture
				}
				modifier = {
					factor = 0.3
					has_character_flag = zakhara_envoy_trade_like
				}
				add_artifact = zakhara_sculpture
				new_artifact = {
					set_name="zakhara_sculpture_name"
					save_event_target_as = zakhara_envoy_artifact
				}
			}
			20 = { 
				modifier = {
					factor = 0
					has_artifact = zakhara_ceremonial_robes
				}
				modifier = {
					factor = 3
					has_character_flag = zakhara_envoy_trade_like
				}
				modifier = {
					factor = 0.3
					has_character_flag = zakhara_envoy_trade_dislike
				}
				add_artifact = zakhara_ceremonial_robes
				new_artifact = {
					save_event_target_as = zakhara_envoy_artifact
				}
			}
			20 = { 
				trigger = { 
					has_character_flag = zakhara_envoy_trade_like
					NOT = { martial <= 10 }
					FROMFROM = { has_character_flag = zakhara_envoy_warrior }
				}
				modifier = {
					factor = 0.1
					has_artifact = art_of_war
				}
				modifier = {
					factor = 2
					martial = 14
				}
				modifier = {
					factor = 2
					martial = 18
				}
				modifier = {
					factor = 2
					martial = 22
				}
				modifier = {
					factor = 2
					martial = 24
				}
				add_artifact = art_of_war
				new_artifact = {
					save_event_target_as = zakhara_envoy_artifact
				}
			}
			20 = { 
				modifier = {
					factor = 0
					has_artifact = silk_shroud
				}
				modifier = {
					factor = 3
					has_character_flag = zakhara_envoy_trade_like
				}
				modifier = {
					factor = 0.3
					has_character_flag = zakhara_envoy_trade_dislike
				}
				add_artifact = silk_shroud
				new_artifact = {
					save_event_target_as = zakhara_envoy_artifact
				}
			}
			15 = { 
				modifier = {
					factor = 0
					has_artifact = zakhara_water_clock
				}
				modifier = {
					factor = 3
					has_character_flag = zakhara_envoy_trade_like
				}
				modifier = {
					factor = 0.3
					has_character_flag = zakhara_envoy_trade_dislike
				}
				add_artifact = zakhara_water_clock
				new_artifact = {
					save_event_target_as = zakhara_envoy_artifact
				}
			}
			15 = { 
				modifier = {
					factor = 0
					has_artifact = zakhara_jian_sword
				}
				modifier = {
					factor = 3
					has_character_flag = zakhara_envoy_trade_like
				}
				modifier = {
					factor = 0.3
					has_character_flag = zakhara_envoy_trade_dislike
				}
				add_artifact = zakhara_jian_sword
				new_artifact = {
					save_event_target_as = zakhara_envoy_artifact
				}
			}
			10 = { 
				modifier = {
					factor = 0
					has_artifact = classic_of_poetry
				}
				modifier = {
					factor = 3
					has_character_flag = zakhara_envoy_trade_like
				}
				modifier = {
					factor = 0.3
					has_character_flag = zakhara_envoy_trade_dislike
				}
				add_artifact = classic_of_poetry
				new_artifact = {
					save_event_target_as = zakhara_envoy_artifact
				}
			}
			1 = {
				add_artifact = zakhara_prev_emperor_sculpture
				new_artifact = {
					set_name="zakhara_figurine_name"
					save_event_target_as = zakhara_envoy_artifact
				}
			}
		}
	}
	
	option = {
		name = EVT_OPTA_ZA_60003
		trigger = { 
			NOT = { has_character_flag = zakhara_envoy_feast_bad }
			event_target:zakhara_envoy_artifact = { has_artifact_flag = decor }
		}
		sound_effect = china_grace_gain
		custom_tooltip = {
			text = artifact_added_tt
		}
		add_grace_trivial_effect = yes
	}
	option = {
		name = EVT_OPTB_ZA_60003
		trigger = { 
			NOT = { has_character_flag = zakhara_envoy_feast_bad }
			NOT = { event_target:zakhara_envoy_artifact = { has_artifact_flag = decor } }
		}
		sound_effect = china_grace_gain
		custom_tooltip = {
			text = artifact_added_tt
		}
		add_grace_trivial_effect = yes
	}
	option = {
		name = EVT_OPTC_ZA_60003
		trigger = { has_character_flag = zakhara_envoy_feast_bad }
		detract_grace_minor_effect = yes
	}
	
	after = {
		clr_character_flag = zakhara_envoy_trade_like
		clr_character_flag = zakhara_envoy_trade_dislike
		clr_character_flag = zakhara_envoy_feast_good
		clr_character_flag = zakhara_envoy_feast_bad
		hidden_effect = { 
			if = {
				limit = {
					FROMFROM = { has_character_flag = zakhara_envoy_artifacts }
				}
				FROMFROM = { death = { death_reason = death_went_back_to_zakhara } }
			}
		}
	}
}

#Visiting councillor leaves you a gift, from ZA.20000
character_event = {
	id = ZA.60004
	has_dlc = "Jade Dragon"
	desc = EVT_DESC_ZA_60004
	picture = GFX_evt_china_diplomatic_success
    border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	immediate = {
		#Spawn artifacts in a character with the current Emperor's culture and religion so loc reffering that stays static and then transfer to intended owner.
		zakhara = {
			governor = {
				random_list = {
					5 = { 
						modifier = {
							factor = 0.1
							ROOT = { has_artifact = zakhara_jade_dragon }
						}
						add_artifact = zakhara_jade_dragon
						new_artifact = {
							transfer_artifact = {
								from = PREV
								to = ROOT
							}
							save_event_target_as = zakhara_envoy_artifact
						}
					}
					15 = { 
						modifier = {
							factor = 0.1
							ROOT = { has_artifact = zakhara_dragon_amulet }
						}
						add_artifact = zakhara_dragon_amulet
						new_artifact = {
							transfer_artifact = {
								from = PREV
								to = ROOT
							}
							save_event_target_as = zakhara_envoy_artifact
						}
					}
					40 = {
						modifier = {
							factor = 0.1
							ROOT = { has_artifact = zakhara_artwork }
						}
						add_artifact = zakhara_artwork
						new_artifact = {
							transfer_artifact = {
								from = PREV
								to = ROOT
							}
							save_event_target_as = zakhara_envoy_artifact
						}
					}
					40 = { 
						modifier = {
							factor = 0.1
							ROOT = { has_artifact = zakhara_calligraphy }
						}
						add_artifact = zakhara_calligraphy
						new_artifact = {
							transfer_artifact = {
								from = PREV
								to = ROOT
							}
							save_event_target_as = zakhara_envoy_artifact
						}
					}
					40 = { 
						modifier = {
							factor = 0.1
							ROOT = { has_artifact = zakhara_sculpture }
						}
						add_artifact = zakhara_sculpture
						new_artifact = {
							transfer_artifact = {
								from = PREV
								to = ROOT
							}
							save_event_target_as = zakhara_envoy_artifact
						}
					}
					20 = { 
						modifier = {
							factor = 0.1
							ROOT = { has_artifact = zakhara_ceremonial_robes }
						}
						add_artifact = zakhara_ceremonial_robes
						new_artifact = {
							transfer_artifact = {
								from = PREV
								to = ROOT
							}
							save_event_target_as = zakhara_envoy_artifact
						}
					}
					20 = { 
						trigger = { 
							event_target:zakhara_guest = { has_job_title = job_marshal }
						}
						modifier = {
							factor = 0.1
							ROOT = { has_artifact = art_of_war }
						}
						modifier = {
							factor = 2
							ROOT = { martial = 14 }
						}
						modifier = {
							factor = 2
							ROOT = { martial = 18 }
						}
						modifier = {
							factor = 2
							ROOT = { martial = 22 }
						}
						modifier = {
							factor = 2
							ROOT = { martial = 24 }
						}
						add_artifact = art_of_war
						new_artifact = {
							transfer_artifact = {
								from = PREV
								to = ROOT
							}
							save_event_target_as = zakhara_envoy_artifact
						}
					}
					20 = { 
						modifier = {
							factor = 0.1
							ROOT = { has_artifact = silk_shroud }
						}
						add_artifact = silk_shroud
						new_artifact = {
							transfer_artifact = {
								from = PREV
								to = ROOT
							}
							save_event_target_as = zakhara_envoy_artifact
						}
					}
					15 = { 
						modifier = {
							factor = 0.1
							ROOT = { has_artifact = zakhara_water_clock }
						}
						add_artifact = zakhara_water_clock
						new_artifact = {
							transfer_artifact = {
								from = PREV
								to = ROOT
							}
							save_event_target_as = zakhara_envoy_artifact
						}
					}
					15 = { 
						modifier = {
							factor = 0.1
							ROOT = { has_artifact = zakhara_jian_sword }
						}
						add_artifact = zakhara_jian_sword
						new_artifact = {
							transfer_artifact = {
								from = PREV
								to = ROOT
							}
							save_event_target_as = zakhara_envoy_artifact
						}
					}
					10 = { 
						modifier = {
							factor = 0.1
							ROOT = { has_artifact = classic_of_poetry }
						}
						add_artifact = classic_of_poetry
						new_artifact = {
							transfer_artifact = {
								from = PREV
								to = ROOT
							}
							save_event_target_as = zakhara_envoy_artifact
						}
					}
				}
			}
		}
	}
	
	option = {
		name = EVT_OPTA_ZA_60003
		trigger = { 
			event_target:zakhara_envoy_artifact = { has_artifact_flag = decor }
		}
		sound_effect = china_grace_gain
		tooltip = { 
			event_target:zakhara_envoy_artifact = { 
				show_scope_change = no
				transfer_artifact = {
					from = event_target:zakhara_guest
					to = ROOT
				}
			}
		}
		add_grace_trivial_effect = yes
	}
	option = {
		name = EVT_OPTB_ZA_60003
		trigger = { 
			NOT = { event_target:zakhara_envoy_artifact = { has_artifact_flag = decor } }
		}
		sound_effect = china_grace_gain
		tooltip = { 
			event_target:zakhara_envoy_artifact = { 
				show_scope_change = no
				transfer_artifact = {
					from = event_target:zakhara_guest
					to = ROOT
				}
			}
		}
		add_grace_trivial_effect = yes
	}
}

#Ruler can get an artifact in ZA.10013 as well

### A Chinese Prince/Princess has died - Sends event to spouse or child ### (fired from on_death)
character_event = { #
    id = ZA.10080
    is_triggered_only = yes
    hide_window = yes
    has_dlc = "Jade Dragon"

    trigger = {
        NOT = {
	        zakhara = {
	        	has_policy = zakhara_isolationist
	        }
		}
    	NAND = {
	    	killer = { character = liege }
			OR = { #make sure China doesn't know they were actually murdered by you
				death_murder_known_trigger = yes
				death_execution_trigger = yes
				death_sacrificed_trigger = yes
				death_reason = death_duel
				death_reason = death_dungeon
			}
    	}
    	OR = {
    		has_character_modifier = jd_prince
    		has_character_modifier = jd_princess
    	}
    	OR = { #Must have either a spouse or a landed child still around
    		any_spouse = {
    			ai = no
    			is_alive = yes
    			is_landed = yes
    			NOT = { is_rival = ROOT }
    			opinion = { who = ROOT value = 30 } #Spouse must have liked the prince/princess at least A LITTLE
    			root_has_terrible_opinion_modifier_of_this_trigger = no
    		}
			any_child = {
				ai = no
				is_landed = yes
				is_alive = yes
				age = 10
				NOT = { is_rival = ROOT }
				root_has_terrible_opinion_modifier_of_this_trigger = no
			}
    	}
    	had_character_flag = { flag = originated_from_zakhara_court days = 1825 } #If less, the regular "grace refund" event will fire instead
    }

    immediate = {
		zakhara = {
			governor = {
				save_event_target_as = the_protector_general
			}    			
		}
    	random_list = {
    		40 = { #China sends their condolences...
    			random_spouse = {
    				limit = {
    					ai = no
    					is_landed = yes
    					NOT = { is_rival = ROOT }
    					NOT = { war_with = event_target:the_protector_general }
    					root_has_terrible_opinion_modifier_of_this_trigger = no
    				}
    				set_character_flag = scenario_1
    				set_character_flag = mourner_is_spouse
    				character_event = { id = ZA.10079 days = 35 }
    			}
    			any_child = {
    				if = {
	    				limit = {
	    					ai = no
		    				age = 15
		    				is_landed = yes
		    				NOT = { is_rival = ROOT }
		    				NOT = { war_with = event_target:the_protector_general }
		    				root_has_terrible_opinion_modifier_of_this_trigger = no
	    				}
	    				set_character_flag = scenario_1
	    				set_character_flag = mourner_is_grown_child
	    				character_event = { id = ZA.10079 days = 35 }
    				}
    			}
    			any_child = {
    				if = {
	    				limit = {
	    					ai = no
	    					age = 10
		    				NOT = { age = 15 }
		    				is_landed = yes
		    				NOT = { is_rival = ROOT }
		    				NOT = { war_with = event_target:the_protector_general }
		    				root_has_terrible_opinion_modifier_of_this_trigger = no
	    				}
	    				set_character_flag = scenario_1
    					set_character_flag = mourner_is_small_child
    					character_event = { id = ZA.10079 days = 35 }
    				}
    			}
    			trigger = {
    				zakhara = {
    					offmap_ruler = {
    						dynasty = ROOT
    					}
    				}
    				OR = {
    					any_child = {
    						ai = no
    						is_landed = yes
    						age = 10
    						NOT = { is_rival = ROOT }
    						NOT = { war_with = event_target:the_protector_general }
    						root_has_terrible_opinion_modifier_of_this_trigger = no
    					}
    					any_spouse = {
    						ai = no
    						is_landed = yes
    						NOT = { is_rival = ROOT }
    						NOT = { war_with = event_target:the_protector_general }
    						root_has_terrible_opinion_modifier_of_this_trigger = no
    					}
    				}
    			}
    		}
    		30 = { #China sends you an artifact
				add_zakhara_artifact_effect = yes

				while = { #runs until it finds an appropriate artifact...
					limit = {
						event_target:zakhara_artifact = {
							NOR = {
								has_artifact_flag = decor
								has_artifact_flag = statue
								has_artifact_flag = art
								has_artifact_flag = clothing
								has_artifact_flag = textile
							}
						}
					}
					event_target:zakhara_artifact = {
						destroy_artifact = yes
					}
					add_zakhara_artifact_effect = yes
				}
				
				event_target:zakhara_artifact = {
					set_name = the_zakhara_royals_favorite
					set_description = the_zakhara_royals_favorite_desc
					set_artifact_flag = royal_inheritance_gift@ROOT
					transfer_artifact = {
						from = PREV
						to = event_target:the_protector_general
					}
				}

				random_spouse = {
    				limit = {
    					ai = no
    					is_landed = yes
    					NOT = { is_rival = ROOT }
    					NOT = { war_with = event_target:the_protector_general }
    					root_has_terrible_opinion_modifier_of_this_trigger = no
    				}
    				set_character_flag = scenario_2
    				set_character_flag = mourner_is_spouse
    				character_event = { id = ZA.10079 days = 35 }
    			}
    			any_child = {
    				if = {
	    				limit = {
	    					ai = no
		    				age = 15
		    				is_landed = yes
		    				NOT = { is_rival = ROOT }
		    				NOT = { war_with = event_target:the_protector_general }
		    				root_has_terrible_opinion_modifier_of_this_trigger = no
	    				}
	    				set_character_flag = scenario_2
	    				set_character_flag = mourner_is_grown_child
	    				character_event = { id = ZA.10079 days = 35 }
    				}
    			}
    			any_child = {
    				if = {
	    				limit = {
	    					ai = no
		    				NOT = { age = 15 }
		    				age = 10
		    				is_landed = yes
		    				NOT = { is_rival = ROOT }
		    				NOT = { war_with = event_target:the_protector_general }
		    				root_has_terrible_opinion_modifier_of_this_trigger = no
	    				}
	    				set_character_flag = scenario_2
	    				set_character_flag = mourner_is_small_child
    					character_event = { id = ZA.10079 days = 35 }
    				}
    			}
    			trigger = {
					zakhara = {
						offmap_ruler = {
							dynasty = ROOT
						}
					}
    				OR = {
    					any_child = {
    						ai = no
    						is_landed = yes
    						age = 10
    						NOT = { is_rival = ROOT }
    						NOT = { war_with = event_target:the_protector_general }
    						root_has_terrible_opinion_modifier_of_this_trigger = no
    					}
    					any_spouse = {
    						ai = no
    						is_landed = yes
    						NOT = { is_rival = ROOT }
    						NOT = { war_with = event_target:the_protector_general }
    						root_has_terrible_opinion_modifier_of_this_trigger = no
    					}
    				}
    			}
    		}
    		15 = { #You find a personal diary...
				add_artifact = zakhara_journal

				new_artifact = {
					save_event_target_as = zakhara_artifact
				}
				event_target:zakhara_artifact = {
					set_name = the_zakhara_royals_personal_note_book
					set_description = the_zakhara_royals_personal_note_book_desc
					set_artifact_flag = royal_inheritance_gift@ROOT
					transfer_artifact = {
						from = PREV
						to = event_target:the_protector_general
					}
				}

				random_spouse = {
    				limit = {
    					ai = no
    					is_landed = yes
    					NOT = { is_rival = ROOT }
    					root_has_terrible_opinion_modifier_of_this_trigger = no
    				}
    				set_character_flag = scenario_3
    				set_character_flag = mourner_is_spouse
    				character_event = { id = ZA.10079 days = 35 }
    			}
    			any_child = {
    				if = {
	    				limit = {
	    					ai = no
		    				is_landed = yes
		    				age = 14
		    				NOT = { is_rival = ROOT }
		    				root_has_terrible_opinion_modifier_of_this_trigger = no
	    				}
	    				set_character_flag = scenario_3
	    				set_character_flag = mourner_is_grown_child
	    				character_event = { id = ZA.10079 days = 35 }
    				}
    			}
    			any_child = {
    				if = {
	    				limit = {
	    					ai = no
		    				is_landed = yes
		    				NOT = { age = 14 }
		    				NOT = { is_rival = ROOT }
		    				root_has_terrible_opinion_modifier_of_this_trigger = no
	    				}
	    				set_character_flag = scenario_3
	    				set_character_flag = mourner_is_small_child
    					character_event = { id = ZA.10079 days = 35 }
    				}
    			}
    			modifier = {
		            factor = 0.5 #less likely if an alive spouse does NOT have family focus (since the prince/princess will write about their family in their journal)
		            any_spouse = {
		            	is_alive = yes
		            	is_landed = yes
		            	NOT = { has_focus = focus_family }
		            }
		        }
		        modifier = {
		            factor = 1.1 #more likely if there was love between the prince/princess and their spouse
		            any_spouse = {
		            	is_alive = yes
		            	is_landed = yes
		            	has_opinion_modifier = { who = ROOT modifier = opinion_lover }
		            }
		        }
    		}
    		15 = {
    			#Nothing happens (more likely if China is busy with other stuff)
    			set_character_flag = nothing_happened
    			modifier = {
		            factor = 5
		            zakhara_is_suffering_trigger = yes
		        }
    		}
    	}
    	if = { limit = { NOT = { has_character_flag = nothing_happened } }
    		set_character_flag = ignore_refund #(blocks the other letter of condolences-event from China)
    	}
    }
}

### Delayed gating event to make sure the Protector General is still alive, and still has the artifact
# Sent on target character, from ZA.10080
character_event = {
    id = ZA.10079
    hide_window = yes
    is_triggered_only = yes
    has_dlc = "Jade Dragon"
    
    immediate = {
    	if = {  #for loc + artifact purposes
    		limit = { event_target:the_protector_general = { is_alive = no } }
    		zakhara = { governor = { save_event_target_as = the_protector_general } }
    	}

    	if = { ### (1) If you are to receive a letter...
    		limit = { has_character_flag = scenario_1 }
			character_event = { id = ZA.10081 }
    	}

    	if = { ### (2) If you are to be gifted a Chinese artifact...
    		limit = { has_character_flag = scenario_2 }
			if = { #if the artifact still exists in the treasury of the WP... (even if the Protector General might've died, but HOPEFULLY they inherited the thing?)
				limit = {
					event_target:the_protector_general = {
						any_artifact = { has_artifact_flag = royal_inheritance_gift@FROM }
					}
				}
				character_event = { id = ZA.10082 } #Continue and send scenario 2...!
			}
			else = {
				character_event = { id = ZA.10081 } # else, send scenario 1 instead...
			}
    	}

    	if = { ### (3) If you are to find a personal journal...
    		limit = { has_character_flag = scenario_3 }
    		if = { #if the artifact still exists in the treasury of the WP... (even if the Protector General might've died, but HOPEFULLY they inherited the thing?)
				limit = {
					event_target:the_protector_general = {
						any_artifact = { has_artifact_flag = royal_inheritance_gift@FROM }
					}
				}
				character_event = { id = ZA.10083 }  #Continue and send scenario 3...!
			}
			else = {
    			character_event = { id = ZA.10081 } # else, send scenario 1 instead...
    		}
    	}


    	### Fall-back clearing of flags (if at war with WP already)...
    	if = {
    		limit = { war_with = event_target:the_protector_general }
			if = {
				limit = { has_character_flag = scenario_2 }
				#to make sure the WP doesn't end up with a ton of Chinese artifacts (named things like "Shan Li's Favorite Tapestry") when the follow-up (ZA.10082) doesn't trigger...
			    hidden_effect = { event_target:zakhara_artifact = { destroy_artifact = yes } }
			}
			if = {
				limit = { NOT = { has_character_flag = scenario_3 } } #The only event that doesn't require peace with WP...
		    	clr_character_flag = mourner_is_spouse
				clr_character_flag = mourner_is_grown_child
				clr_character_flag = mourner_is_small_child
				clr_character_flag = scenario_1
				clr_character_flag = scenario_2
		    	clr_character_flag = scenario_3
			}
    	}
    }
}

### For a spouse or child ###
character_event = { #China sends their condolences, in the form of a LETTER...
    id = ZA.10081
    desc = EVTDESC_ZA_10081
    picture = GFX_evt_chinese_bureaucrat
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

    has_dlc = "Jade Dragon"

    portrait = FROMFROM

    trigger = {
    	NOT = { war_with = event_target:the_protector_general }
    }

    immediate = {
    	zakhara = {
			governor = {
				save_event_target_as = the_protector_general
			}    			
		}
    }

    #Basically, if you are Depressed, you get to choose between a shot at losing Depressed
    # or some Grace. If you are NOT Depressed, there is a risk you will gain the trait instead, if you choose to read the letter.
    option = {
        name = EVTOPTA_ZA_10081
        custom_tooltip = { text = EVTOPTA_ZA_10081_TT }

        if = {
        	limit = { NOT = { trait = depressed } }
	        random = {
	        	chance = 50
	        	add_trait_depressed_effect = yes #only happens if you are NOT depressed
	        }
        }
        add_grace_minor_effect = yes
    }
    option = {
        name = {
        	text = EVTOPTB_ZA_10081_depressed
        	trigger = { trait = depressed }
        }
        name = {
        	text = EVTOPTB_ZA_10081_regular
        	trigger = { NOT = { trait = depressed } }
        }
        if = {
        	limit = { trait = depressed }
        	custom_tooltip = { text = EVTOPTB_ZA_10081_TT }
        }

        if = {
        	limit = { trait = depressed }
		    random = {
		    	chance = 50
				remove_trait_depressed_effect = yes
		    }
        }
    }

    after = {
    	clr_character_flag = mourner_is_spouse
    	clr_character_flag = mourner_is_grown_child
    	clr_character_flag = mourner_is_small_child
    	clr_character_flag = scenario_1
    	clr_character_flag = scenario_2
    	clr_character_flag = scenario_3
    }
}

### For a spouse or child ###
character_event = { #China sends their condolences, in the form of a GIFT...
    id = ZA.10082
    desc = EVTDESC_ZA_10082
    picture = GFX_evt_chinese_bureaucrat
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

    has_dlc = "Jade Dragon"

    portrait = FROMFROM

    trigger = {
    	NOT = { war_with = event_target:the_protector_general }
    }

    #Basically, if you are Depressed, you get to choose between a shot at losing Depressed
    # or an artifact. If you are NOT Depressed, there is a risk you will gain the trait instead, if you choose to accept the gift.
    option = {
        name = EVTOPTA_ZA_10082
        custom_tooltip = { text = EVTOPTA_ZA_10082_TT }

        hidden_effect = {
	        event_target:zakhara_artifact = {
				transfer_artifact = {
					from = event_target:the_protector_general
					to = ROOT
				}
			}
        }

        if = { limit = { NOT = { trait = depressed } }
	        random = {
	        	chance = 50
	        	add_trait_depressed_effect = yes #only happens if you are NOT depressed
	        }
        }
    }
    option = {
        name = EVTOPTB_ZA_10082
        custom_tooltip = { text = EVTOPTB_ZA_10082_TT }

        if = {
        	limit = { trait = depressed } 
		    random = {
		    	chance = 50
		    	remove_trait_depressed_effect = yes  #only happens if you ARE depressed
		    }
        }
        hidden_effect = {
        	event_target:zakhara_artifact = {
        		destroy_artifact = yes
        	}
        }
    }

    after = {
    	clr_character_flag = mourner_is_spouse
    	clr_character_flag = mourner_is_grown_child
    	clr_character_flag = mourner_is_small_child
    	clr_character_flag = scenario_1
    	clr_character_flag = scenario_2
    	clr_character_flag = scenario_3
    }
}


### For a spouse or child ###
character_event = { #You find their journal...
    id = ZA.10083
    desc = EVTDESC_ZA_10083
    picture = GFX_evt_library
    border = GFX_event_normal_frame_diplomacy
    is_triggered_only = yes

	has_dlc = "Jade Dragon"

    portrait = FROMFROM

    option = {
        name = EVTOPTA_ZA_10083
        custom_tooltip = { text = EVTOPTA_ZA_10083_TT }

        hidden_effect = {
	        event_target:zakhara_artifact = {
				transfer_artifact = {
					from = event_target:the_protector_general
					to = ROOT
				}
			}
        }
    }
    option = {
        name = EVTOPTB_ZA_10083
        custom_tooltip = { text = EVTOPTB_ZA_10083_TT }
        
        if = {
			limit = {
				NOT = { trait = cynical }
			}
			add_trait = cynical
		}

        hidden_effect = {
        	event_target:zakhara_artifact = {
        		destroy_artifact = yes
        	}
        }
    }

    after = {
    	clr_character_flag = mourner_is_spouse
    	clr_character_flag = mourner_is_grown_child
    	clr_character_flag = mourner_is_small_child
    	clr_character_flag = scenario_1
    	clr_character_flag = scenario_2
    	clr_character_flag = scenario_3
    }
}